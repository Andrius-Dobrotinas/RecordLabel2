<div class="">
    <div ng-repeat="error in validationErrors">
        <div class="alert alert-danger" role="alert">
            <span class="glyphicon glyphicon-exclamation-sign"></span>
            {{error.error}} ({{error.field}})
        </div>
    </div>

    <form name="ReleaseForm" novalidate>
        <div class="form-group row">
            <label for="Title" class="control-label col-sm-2">Title</label>
            <div class="col-sm-10">
                <input type="text" name="Title" id="Title" class="form-control" ng-model="model.Title" required />
                <div ng-show="isEmptyForRequired(ReleaseForm.Title)" class="text-danger">Release Title is required</div>
            </div>
        </div>
        <div class="form-group row">
            <label for="Date" class="control-label col-sm-2">Release Year</label>
            <div class="col-sm-10">
                <input type="number" name="Date" id="Date" class="form-control" ng-model="model.Date" required 
                       min="{{constants.MinDate}}" max="{{constants.MaxDate}}" />
                <div ng-show="isEmptyForRequired(ReleaseForm.Date)" class="text-danger">Release Date is required</div>
                <div ng-show="isValidForRequired(ReleaseForm.Date)" class="text-danger">Release Date must be a valid year between {{constants.MinDate}} and {{constants.MaxDate}}</div>
            </div>
        </div>
        <div class="form-group row">
            <label for="ArtistId" class="control-label col-sm-2">Artist</label>
            <div class="col-sm-10">
                <select id="ArtistId" name="ArtistId" class="form-control" ng-model="model.ArtistId" 
                        ng-options="item.Id as item.Name for item in artists"
                        required min="1">
                    <option value="">Select one...</option>
                </select>
                <div ng-show="isEmptyForRequired(ReleaseForm.ArtistId)" class="text-danger">Select an Artist</div>
            </div>
        </div>
        <div class="form-group row">
            <label for="CatNumber" class="control-label col-sm-2">Catalogue Number</label>
            <div class="col-sm-10">
                <input type="text" name="CatNumber" id="CatNumber" class="form-control" ng-model="model.CatalogueNumber" required />
                <div ng-show="isEmptyForRequired(ReleaseForm.CatNumber)" class="text-danger">Release Catalogue number is required</div>
            </div>
        </div>

        <div class="form-group row">
            <label for="MediaId" class="control-label col-sm-2">Media</label>
            <div class="col-sm-10">
                <select id="MediaId" name="MediaId" class="form-control" ng-model="model.MediaId" 
                        ng-options="item.Id as item.Text for item in mediaTypes"
                        required min="1">
                    <option value="">Select one...</option>
                </select>
                <div ng-show="isEmptyForRequired(ReleaseForm.MediaId)" class="text-danger">Select a Media type</div>
            </div>
        </div>
        <div class="form-group row">
            <label for="Length" class="control-label col-sm-2">Length</label>
            <div class="col-sm-10">
                <input name="Length" id="Length" type="number" class="form-control" ng-model="model.Length" required min="0"
                       placeholder="Release length in minutes" />
                <div ng-show="isEmptyForRequired(ReleaseForm.Length)" class="text-danger">Release Length is required</div>
                <div ng-show="isValidForRequired(ReleaseForm.Length)" class="text-danger">Release Length must be a positive number</div>
            </div>
        </div>
        <div class="form-group row">
            <label for="PrintStatusId" class="control-label col-sm-2">Print Status</label>
            <div class="col-sm-10">
                <select id="PrintStatusId" name="PrintStatusId" class="form-control" ng-model="model.PrintStatus" 
                        ng-options="item.Id as item.Text for item in constants.PrintStatuses">
                </select>
            </div>
        </div>
        <div class="form-group row">
            <label for="Title" class="control-label col-sm-2">Text</label>
            <div class="col-sm-10">
                <input type="text" name="Text" id="Text" class="form-control" ng-model="model.Text" 
                       placeholder="Some short description of release to be displayed in release list" />
            </div>
        </div>

        <div class="form-group row">
            <label for="MedatadaIds" class="control-label col-sm-2">Metadata</label>
            <div class="col-sm-10">
                <select multiple id="MedatadaIds" name="MedatadaIds" class="form-control" ng-model="model.MetadataIds" 
                        ng-options="item.Id as item.Text for item in metadataList">
                </select>
            </div>
        </div>

        <div class="form-group row">            
            <div class="col-sm-10 col-sm-offset-2">
                <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#Tracks" data-backdrop="static" data-keyboard="false">
                    Edit Tracklist
                </button>
                <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#References" data-backdrop="static" data-keyboard="false">
                    Edit References
                </button>
            </div>
        </div>

        <div class="row">
            <button class="btn btn-success" ng-click="update(ReleaseForm)">Save</button>
        </div>

        <!--Modals-->

        <div modal-box modal-id="References" modal-title="Edit References" modal-close-btn-title="Done" 
             modal-close-btn-disabled="RefsForm.$invalid" modal-no-top-close-btn="RefsForm.$invalid" ng-form="RefsForm">
            <modal-box-body>
                <div ng-repeat="ref in model.References track by $index" ng-form="RefForm">
                    <div>
                        <button type="button" name="remove" class="close" ng-click="deleteReference($index)">
                            <span class="glyphicon glyphicon-remove"></span>
                        </button>
                    </div>
                    <div class="form-group row">
                        <label class="control-label col-sm-2">Target</label>
                        <div class="col-sm-10">
                            <input type="text" name="Target" class="form-control" ng-model="ref.Target" required />
                            <div ng-show="isEmptyForRequired(RefForm.Target)" class="text-danger">Reference Target is required</div>
                        </div>
                    </div>
                    <div class="form-group row">
                        <label class="control-label col-sm-2">Type</label>
                        <div class="col-sm-10">
                            <select class="form-control" ng-model="ref.Type"
                                    ng-options="item.Id as item.Text for item in constants.ReferenceTypes"></select>
                        </div>
                    </div>
                    <div class="form-group row">
                        <label class="control-label col-sm-2">Order</label>
                        <div class="col-sm-10">
                            <input type="number" class="form-control" ng-model="ref.Order"
                                   placeholder="TODO: Currently, doesn't do anything'" />
                        </div>
                    </div>
                </div>
                <div>
                    <button type="button" class="btn btn-default" ng-click="addReference()">Add</button>
                </div>
            </modal-box-body>
        </div>

        <div modal-box modal-id="Tracks" modal-title="Edit Tracklist" modal-close-btn-title="Done"
             modal-close-btn-disabled="RefsForm.$invalid" modal-no-top-close-btn="RefsForm.$invalid" ng-form="RefsForm">
            <modal-box-body>
                <div ng-repeat="track in model.Tracks track by $index" ng-form="TrackForm">
                    <button type="button" name="remove" class="close" ng-click="deleteTrack($index)">
                        <span class="glyphicon glyphicon-remove"></span>
                    </button>
                    <div class="form-group row">
                        <label class="control-label col-sm-2">Title</label>
                        <div class="col-sm-10">
                            <input type="text" name="Title" class="form-control" ng-model="track.Title" required />
                            <div ng-show="isEmptyForRequired(TrackForm.Title)" class="text-danger">Track Title is required</div>
                        </div>
                    </div>
                    <div class="form-group row">
                        <label class="control-label col-sm-2">Reference Target</label>
                        <div class="col-sm-10">
                            <input type="text" name="Target" class="form-control" ng-model="track.Reference" />
                            <div ng-show="isEmptyForRequired(TrackForm.Target)" class="text-danger">Reference Target is required</div>
                        </div>
                    </div>
                </div>
                <div>
                    <button type="button" class="btn btn-default" ng-click="addTrack()">Add</button>
                </div>
            </modal-box-body>
        </div>

    </form>
</div>